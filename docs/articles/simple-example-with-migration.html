<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Simple Example With Migration • CKMRpop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Simple Example With Migration">
<meta property="og:description" content="CKMRpop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CKMRpop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about_spip.html">About spip</a>
    </li>
    <li>
      <a href="../articles/simple-example-with-migration.html">A Simple Example With Migration</a>
    </li>
    <li>
      <a href="../articles/species_1_simulation.html">Simulation from species 1 life history</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simple-example-with-migration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Simple Example With Migration</h1>
                        <h4 class="author">Eric C. Anderson</h4>
            
            <h4 class="date">2021-07-13</h4>
      
      
      <div class="hidden name"><code>simple-example-with-migration.Rmd</code></div>

    </div>

    
    
<p>In this vignette we show how to use CKMRpop/spip in a multi-population version with asymmetrical migration rates. It would be good to read the “about_spip” vignette beforehand to understand how migration is implemented in spip.</p>
<p>Our goal here is to model three “populations” of a fish species in which migration occurs during the larval stage, and it is influenced by currents that flow down the coast and make migration occur primarily in one direction. Each of the populations will have the same life tables, etc. We will make it simple.</p>
<p>First load some packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CKMRpop</span><span class="op">)</span></code></pre></div>
<div id="basic-demography" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-demography" class="anchor"></a>Basic Demography</h2>
<p>The basic demography for each, is given below. We assume no mortality from newborn to age one. In effect we are only modeling the the newborns that survive to age 1. Only 3, 4, and 5 year-olds mate, and older fish have somewhat more reproductive success.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`max-age`</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`fem-surv-probs`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`male-surv-probs`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`fem-prob-repro`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`male-prob-repro`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`fem-asrf`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`male-asrp`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">.7</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`fem-rep-disp-par`</span> <span class="op">&lt;-</span> <span class="fl">0.25</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`male-rep-disp-par`</span> <span class="op">&lt;-</span> <span class="fl">0.25</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`sex-ratio`</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></code></pre></div>
<p>We will run these simulations for 25 years and just assume an annual cohort size of 200 fish in each population, and we will go for a constant population size and start off with the stable age distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars</span><span class="op">$</span><span class="va">`number-of-years`</span> <span class="op">&lt;-</span> <span class="fl">25</span>

<span class="co"># given cohort sizes of 250 the stable age distribution</span>
<span class="co"># can be found and used for the initial number of indivs</span>
<span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/leslie_from_spip.html">leslie_from_spip</a></span><span class="op">(</span><span class="va">pars</span>, <span class="fl">250</span><span class="op">)</span>


<span class="co"># then we add those to the spip parameters</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`initial-males`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">L</span><span class="op">$</span><span class="va">stable_age_distro_fem</span><span class="op">)</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`initial-females`</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">L</span><span class="op">$</span><span class="va">stable_age_distro_male</span><span class="op">)</span>

<span class="va">pars</span><span class="op">$</span><span class="va">`cohort-size`</span> <span class="op">&lt;-</span> <span class="st">"const 250"</span></code></pre></div>
</div>
<div id="sampling" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling" class="anchor"></a>Sampling</h2>
<p>We will simulate a sampling program in which juveniles are sampled when they recruit after their larval phase. We assume that the larval phase starts at birth, but is over by age 1. So we can sample new recruits via prekill sampling at age 1. We will pretend the sampling is non-lethal. We will also non-lethally sample a fraction of the older age-class fish.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars</span><span class="op">$</span><span class="va">`discard-all`</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`gtyp-ppn-fem-pre`</span> <span class="op">&lt;-</span> <span class="st">"10-25 0.05 0.00 0.00 0.00 0.00"</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`gtyp-ppn-male-pre`</span> <span class="op">&lt;-</span> <span class="st">"10-25 0.05 0.00 0.00 0.00 0.00"</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`gtyp-ppn-fem-post`</span> <span class="op">&lt;-</span> <span class="st">"10-25 0.00 0.01 0.01 0.01 0.01"</span>
<span class="va">pars</span><span class="op">$</span><span class="va">`gtyp-ppn-male-post`</span> <span class="op">&lt;-</span> <span class="st">"10-25 0.00 0.01 0.01 0.01 0.01"</span></code></pre></div>
<p>OK! At this point, we have set up the demography for a single population. Let’s just show that we could simulate a single population with that demography and the sampling like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>
<span class="va">one_pop_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_spip.html">run_spip</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span>, num_pops <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>But, of course, the question is, how do we simulate multiple, interacting populations?</p>
</div>
<div id="simulating-multiple-populations" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-multiple-populations" class="anchor"></a>Simulating Multiple Populations</h2>
<p>To simulate multiple populations in spip, from within CKMRpop, we set the <code>num_pops</code> option of <code><a href="../reference/run_spip.html">run_spip()</a></code> to the number of populations. And then, for the <code>pars</code> option we pass a <em>list</em> of <code>num_pops</code> different lists, each one holding the demography and sampling information for each of the populations in the simulation. In our case, since we are simulating three populations with the same demography, <code>num_pops = 3</code> and we can construct our <code>pars</code> argument like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">pars</span>,
  <span class="va">pars</span>,
  <span class="va">pars</span>
<span class="op">)</span></code></pre></div>
<p>because each population has the same demography.</p>
<p>Note that we have not included any migration between the the populations yet, but we can still run a simulation with all of them like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>
<span class="va">three_pop_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_spip.html">run_spip</a></span><span class="op">(</span>
  pars <span class="op">=</span> <span class="va">pars_list</span>,
  num_pops <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>
<span class="va">slurp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slurp_spip.html">slurp_spip</a></span><span class="op">(</span><span class="va">three_pop_dir</span>, num_generations <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>And you can investigate that output by making the plots and other summaries shown in the main vignette. Many of these summaries account for the multiple populations like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ggplot_census_by_year_age_sex.html">ggplot_census_by_year_age_sex</a></span><span class="op">(</span><span class="va">slurp3</span><span class="op">$</span><span class="va">census_postkill</span><span class="op">)</span></code></pre></div>
<p><img src="simple-example-with-migration_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>Those are the postkill census sizes in the three different populations, which get the labels 0, 1, and 2, according to the order in which they were passed to spip (i.e., their order in the <code>pars_list</code>, above.)</p>
</div>
<div id="migration-between-multiple-populations" class="section level2">
<h2 class="hasAnchor">
<a href="#migration-between-multiple-populations" class="anchor"></a>Migration between multiple populations</h2>
<p>The above simulated multiple populations, but did not simulate any migration between them.</p>
<p>Here, we will imagine different rates of self-recruitment of the larvae, which means different rates at which surviving larvae are going to be migrants. The populations are labeled 0, 1, and 2, and, as stated above, we will simulate somewhat unidirectional migration between them, like so:</p>
<ul>
<li>20% of pop 0 individuals are migrants; 80% of those end up in pop 1 and 20% in pop 2</li>
<li>15% of pop 1 indivs are migrants; 95% of them end up in pop 2 and 5% in pop 0</li>
<li>5% of pop 2 are migrants; 90% of those end up in pop 1 and 10% make it to pop 0.</li>
</ul>
<p>The way we implement this is by adding options to each population’s demography parameters like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># out-migration rates pops 0, 1, 2</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .20"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .20"</span>

<span class="va">pars_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .15"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .15"</span>

<span class="va">pars_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .05"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-out`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 .05"</span>

<span class="co"># in-migration rates</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-in`</span> <span class="op">&lt;-</span>  <span class="st">"5-25 1 0.00 0.80 0.20"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-in`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 0.00 0.80 0.20"</span>

<span class="va">pars_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-in`</span> <span class="op">&lt;-</span>  <span class="st">"5-25 1 0.05 0.00 0.95"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-in`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 0.05 0.00 0.95"</span>

<span class="va">pars_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`fem-prob-mig-in`</span> <span class="op">&lt;-</span>  <span class="st">"5-25 1 0.10 0.90 0.00"</span>
<span class="va">pars_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">`male-prob-mig-in`</span> <span class="op">&lt;-</span> <span class="st">"5-25 1 0.10 0.90 0.00"</span></code></pre></div>
<p>Now, we can simulate this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>
<span class="va">mig_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_spip.html">run_spip</a></span><span class="op">(</span>
  pars <span class="op">=</span> <span class="va">pars_list</span>,
  num_pops <span class="op">=</span> <span class="fl">3</span>
<span class="op">)</span>
<span class="va">slurp_mig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slurp_spip.html">slurp_spip</a></span><span class="op">(</span><span class="va">mig_dir</span>, num_generations <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Now, the object <code>slurp_mig</code> holds information about census sizes of the populations and the relationships between samples, etc. That can be broken down by populations.</p>
<p>First, a record of every migration event is stored in <code>slurp_mig$migrants</code>. This can be easily summarized:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">slurp_mig</span><span class="op">$</span><span class="va">migrants</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">age</span>, <span class="va">from_pop</span>, <span class="va">to_pop</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;     age from_pop to_pop     n</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1        0      1   876</span>
<span class="co">#&gt; 2     1        0      2   227</span>
<span class="co">#&gt; 3     1        1      0    41</span>
<span class="co">#&gt; 4     1        1      2   793</span>
<span class="co">#&gt; 5     1        2      0    35</span>
<span class="co">#&gt; 6     1        2      1   250</span></code></pre></div>
<p>For a further example, to tabulate parent-offspring pairs found between different populations, we can compile the relationships and summarize:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compile relationships</span>
<span class="va">crel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compile_related_pairs.html">compile_related_pairs</a></span><span class="op">(</span><span class="va">slurp_mig</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>

<span class="co"># count number of PO pairs by which populations</span>
<span class="co"># the members were born in</span>
<span class="va">crel</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">dom_relat</span> <span class="op">==</span> <span class="st">"PO"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    parent_born_pop <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="va">upper_member</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">born_pop_1</span>,
      <span class="va">upper_member</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">born_pop_2</span>,
      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_integer_</span>
    <span class="op">)</span>,
    child_born_pop <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="va">upper_member</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">born_pop_2</span>,
      <span class="va">upper_member</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">born_pop_1</span>,
      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_integer_</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">parent_born_pop</span>, <span class="va">child_born_pop</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   parent_born_pop child_born_pop     n</span>
<span class="co">#&gt;             &lt;int&gt;          &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1               0              0    45</span>
<span class="co">#&gt; 2               0              1     3</span>
<span class="co">#&gt; 3               1              1    31</span>
<span class="co">#&gt; 4               1              2     3</span>
<span class="co">#&gt; 5               2              1     1</span>
<span class="co">#&gt; 6               2              2    37</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eric C. Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
