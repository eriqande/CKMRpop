<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>About spip • CKMRpop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="About spip">
<meta property="og:description" content="CKMRpop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CKMRpop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about_spip.html">About spip</a>
    </li>
    <li>
      <a href="../articles/simple-example-with-migration.html">A Simple Example With Migration</a>
    </li>
    <li>
      <a href="../articles/species_1_simulation.html">Simulation from species 1 life history</a>
    </li>
    <li>
      <a href="../articles/using-other-simulation-programs.html">Using Other Simulation Programs with CKMRpop</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="about_spip_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>About spip</h1>
                        <h4 class="author">Eric C. Anderson</h4>
            
            <h4 class="date">2021-09-05</h4>
      
      
      <div class="hidden name"><code>about_spip.Rmd</code></div>

    </div>

    
    
<p>This provides a short description of a few things that one should know about how <code>spip</code> works.</p>
<div id="timing-of-events-in-a-spip-life-cycle" class="section level2">
<h2 class="hasAnchor">
<a href="#timing-of-events-in-a-spip-life-cycle" class="anchor"></a>Timing of events in a <code>spip</code> life cycle</h2>
<p><code>spip</code> is a program that records time in discrete periods that can be thought of as years. When individuals are born at time <span class="math inline">\(t\)</span> they are considered to be of age 0 and they have a birth year of <span class="math inline">\(t\)</span>. The user must input to the program the maximum possible age of an individual. Here, we will refer that maximum age as <span class="math inline">\(\mathrm{MA}\)</span>.</p>
<p>Within each year in <code>spip</code> the following events occur, in order:</p>
<ol style="list-style-type: decimal">
<li>The age of each individual is incremented at the beginning of the new year <span class="math inline">\(t\)</span>. This means that newborns from year <span class="math inline">\(t-1\)</span> are turned into 1-year-olds as they enter year <span class="math inline">\(t\)</span>, and so forth.</li>
<li>Next there is a chance to sample individuals before the death episode. Only individuals of ages 1 to <span class="math inline">\(\mathrm{MA}\)</span> can be sampled. These are the individuals, who, if they survive the upcoming death episode, might have the chance to contribute to the next generation.</li>
<li>Next there is an episode of death. Individuals that are <span class="math inline">\(a\)</span> years old in year <span class="math inline">\(t\)</span> survive this episode of death with a probability of <span class="math inline">\(s_a\)</span>. Individuals that are <span class="math inline">\(\mathrm{MA} + 1\)</span> are all killed with probability of 1.</li>
<li>Then there is a chance to sample individuals after the episode of death. Only individuals of ages 1 to <span class="math inline">\(\mathrm{MA}\)</span> can be sampled. This is a sample from the individuals that are around and alive to contribute to the next generation.</li>
<li>Next there is an episode of reproduction which produces 0-year-olds born at time <span class="math inline">\(t\)</span>.
<ul>
<li>During the reproduction episode there is an opportunity to draw a sample from the individuals that were chosen to be amongst the reproducing adults. (This is particularly useful for critters like salmon that can be sampled explicitly when they are migrating in fresh water to reproduce).</li>
<li>After the sampling period during reproduction, there is also the chance for individuals to die after reproduction according to the probability set by <code>--fem-postrep-die</code> and <code>--male-postrep-die</code>. With this value set to 1, for example, semelparity can be enforced.</li>
</ul>
</li>
<li>After reproduction there are individuals of ages 0 to <span class="math inline">\(\mathrm{MA}\)</span> that sit around and don’t do much of anything. Eventually the year gets advanced to the following one (<span class="math inline">\(t+1\)</span>), and the ages of individuals get incremented, so that at the beginning of year <span class="math inline">\(t+1\)</span> individuals are of ages 1 to <span class="math inline">\(\mathrm{MA}+1\)</span>.</li>
</ol>
<p>It is worth noting that even though there are some <span class="math inline">\(\mathrm{MA}+1\)</span>-year-olds around at the beginning of each time period, they all die during the episode of death, and, because they cannot be sampled during the sampling episode before death, it is like they do not exist.</p>
<p>The year in spip can thus be divided into three different periods between the demographic events/episodes:</p>
<ol style="list-style-type: decimal">
<li>The period before the episode of death. This is known as the <em>prekill</em> period of the year, and, in the following, we will use a superscript <span class="math inline">\(\mbox{}^\mathrm{pre}\)</span> to denote census sizes during that period.</li>
<li>The period after the episode of death, but before reproduction. This is known as the <em>postkill</em> period, and will be denoted with a superscript <span class="math inline">\(\mbox{}^\mathrm{pok}\)</span>.</li>
<li>The period after reproduction, but before the year gets incremented. This is the <em>post-reproduction</em> period and will be denoted with a superscript <span class="math inline">\(\mbox{}^\mathrm{por}\)</span>.</li>
</ol>
<p>We will use <span class="math inline">\(F_{t,a}^\mathrm{pre}\)</span>, <span class="math inline">\(F_{t,a}^\mathrm{pok}\)</span>, and <span class="math inline">\(F_{t,a}^\mathrm{por}\)</span> to denote the number of <span class="math inline">\(a\)</span>-year-old females during the prekill, postkill, and post-reproduction periods, respectively, of time <span class="math inline">\(t\)</span>. The diagram below, showing these numbers in relation to one another, along with notations of their expected values should help users to understand the spip annual cycle. The numbers of males change across time periods in a similar fashion. <img src="../man/figures/spip-periods.svg" width="100%"></p>
<p>Annotated in the above are the three distinct periods in spip’s annual cycle: the <em>prekill</em>, <em>postkill</em> and <em>post-reproductive</em> periods. When the output of spip is slurped up by CKMRpop, these numbers become the respective tibbles (elements of the output list of <code><a href="../reference/slurp_spip.html">slurp_spip()</a></code>) of: <code>census_prekill</code>, <code>census_postkill</code>, and <code>census_postrepro</code>, respectively.</p>
<p>The expected numbers of individuals after each transition is as follows:</p>
<ul>
<li><span class="math inline">\(F_{t,a}^\mathrm{pre} \equiv F_{t-1,a-1}^\mathrm{por}~~,~~a = 1,\ldots,\mathrm{MA}\)</span></li>
<li>
<span class="math inline">\(E[F_{t,a}^\mathrm{pok}] = s_a^F F_{t,a}^\mathrm{pre}~~,~~a = 1,\ldots,\mathrm{MA}\)</span>, where <span class="math inline">\(s_a^F\)</span> is the probability that an <span class="math inline">\(a-1\)</span> year old female survives to be an <span class="math inline">\(a\)</span> year old female, as given with the <code>--fem-surv-probs</code> option.</li>
<li>
<span class="math inline">\(E[F_{t,a}^\mathrm{por}] = (1 - r_a^Fd_a^F) F_{t,a}^\mathrm{pok}~~,~~a = 1,\ldots,\mathrm{MA}\)</span>, where <span class="math inline">\(r_a^F\)</span> is the probability that an <span class="math inline">\(a\)</span>-year-old female reproduces (set with the <code>--fem-prob-repro</code> option) and <span class="math inline">\(d_a^F\)</span> is the probability that an <span class="math inline">\(a\)</span>-year-old female will die after engaging in reproduction (even if no offspring were actually produced!), as given in the <code>--fem-postrep-die</code> option. This is an additional source of death that is useful for modeling anadromous species whose reproductive journey incurs a substantial cost.</li>
</ul>
</div>
<div id="sampling-episodes-in-a-spip-annual-cycle" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-episodes-in-a-spip-annual-cycle" class="anchor"></a>Sampling episodes in a <code>spip</code> annual cycle</h2>
<p>The two main sampling schemes available in spip are keyed to these different time periods within the spip annual cycle as shown by the following figure: <img src="../man/figures/spip-periods-with-sampling.svg" width="100%"> Thus, <code>--gtyp-ppn-fem-pre</code> and <code>--gtyp-ppn-male-pre</code> involve sampling from the simulated population at a different point in the year than do the <code>--gtyp-ppn-fem-post</code> and <code>--gtyp-ppn-male-post</code> options.<br>
It is also possible to only sample those individuals that are trying to reproduce in a certain year using a third sampling scheme requested with the <code>--gtyp-ppn-fem-dur</code> and <code>--gtyp-ppn-male-dur</code> options to spip. The probability that an individual would try to reproduce in a given year is age specific and is set using the <code>--fem-prob-repro</code> and <code>--male-prob-repro</code> options.</p>
<p>It is worth noting that the <code>pre</code>, <code>post</code> and <code>dur</code>, sampling options all occur relatively independently (so long as sampling is not lethal—see the somewhat experimental <code>--lethal-sampling</code> option). spip reports the different years when an individual is sampled during the <code>pre</code>, <code>post</code>, and <code>dur</code> periods in the year. CKMRpop preserves those times in separate lists when it slurps up the spip output. For example <code>slurped$samples</code> has the list columns: <code>samp_years_list_pre</code>, <code>samp_years_list_post</code>, and <code>samp_years_list_dur</code>. For all downstream analyses, CKMRpop uses the list column <code>samp_years_list</code>, which, by default is the same as the <code>samp_years_list_post</code>. This means, at the present time, you should use the options to sample individuals after the episode of death using the the <code>--gtyp-ppn-fem-post</code> and <code>--gtyp-ppn-male-post</code> options.</p>
<p>Note that, in most cases when exploring CKMR, the user will want to use the <code>--gtyp-ppn-fem-post</code> and <code>--gtyp-ppn-male-post</code> options, anyway, because those are samples from the adult population that are available for reproduction.</p>
<p>If it is desired to sample all newborns at time <span class="math inline">\(t\)</span>, then currently the way to do that is to sample 1-year-olds at time <span class="math inline">\(t+1\)</span> using the <code>--gtyp-ppn-fem-pre</code> and <code>--gtyp-ppn-male-pre</code> options. However, it would take some extra finagling to get those sampling years into the <code>samp_years_list</code> column referenced above for the downstream analyses.</p>
<p>TODO ITEM: combine sampling at all times into the single <code>samp_years_list</code> column, perhaps, or make it easier for users to decide how to combine those different sampling episodes. For now, though, users should stick to using the <code>--gtyp-ppn-fem-post</code> and <code>--gtyp-ppn-male-post</code> options.</p>
</div>
<div id="how-inter-population-migration-occurs-in-spip" class="section level2">
<h2 class="hasAnchor">
<a href="#how-inter-population-migration-occurs-in-spip" class="anchor"></a>How inter-population migration occurs in <code>spip</code>
</h2>
We can use the same diagrams developed above to describe how migration is implemented in <code>spip</code>. Migration in <code>spip</code> is a “two-stage” phenomenon: in the first stage, individuals leave a population with sex-, year- and age-specific out-migration rates specified with the population’s options <code>--fem-prob-mig-out</code> and <code>--male-prob-mig-out</code>. They leave each population before the prekill census occurs and also before the prekill sampling occurs. Diagrammatically, it looks like this:
<div class="figure">
<img src="../man/figures/spip-periods-with-migration.svg" alt="Schematic describing the first stage of migration: migration out of a population. Each blue line shows individuals leaving the population and entering a pool of migrants." width="100%"><p class="caption">
Schematic describing the first stage of migration: migration out of a population. Each blue line shows individuals leaving the population and entering a pool of migrants.
</p>
</div>
<p>The expected numbers of individuals in the pool of migrants who have left the population is given by the time- and age-specific rates set by the user. We will denote the outmigration rate for age <span class="math inline">\(a\)</span> individuals at time <span class="math inline">\(t\)</span> from a given population by <span class="math inline">\(m^\mathrm{out}_{t,a}\)</span>. It follows then that, for this given population: <span class="math display">\[
E[F^\mathrm{out}_{t,a}] = m^\mathrm{out}_{t,a}F_{t-1,a-1},~a=1,\ldots, \mathrm{MA}.
\]</span></p>
<p>In the following, we will want to refer to these outmigration rates for each population, so we may also adorn the notation, thus: <span class="math display">\[
E[F^{\mathrm{out},i}_{t,a}] = m^{\mathrm{out},i}_{t,a}F^i_{t-1,a-1},~a=1,\ldots, \mathrm{MA}.
\]</span></p>
<p>to refer to rates and sizes specifically for population <span class="math inline">\(i\)</span>.</p>
<p>After the outmigration stage, each population has a pool of migrants that are waiting to migrate into other populations. The rates by which this happens are specified with the <code>--fem-prob-mig-in</code> and <code>--male-prob-mig-in</code> options. These options set in-migration rates for different years and for different ages, effectively setting the fraction of the total number of out-migrated individuals from population <span class="math inline">\(i\)</span> of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span>, <span class="math inline">\(F^{\mathrm{out},i}_{t,a}\)</span>, that will migrate into the other populations. Thus, there is one number to set for each population. For example, if there are <span class="math inline">\(K\)</span> populations, we would have: <span class="math display">\[
m^{\mathrm{in},i}_{t,a} = [m^{\mathrm{in},i}_{t,a,1},\ldots,m^{\mathrm{in},i}_{t,a,K}]~~,~~
\sum_{j=1}^K m^{\mathrm{in},i}_{t,a,j} = 1.
\]</span> The probability of migrating back to the population from whence one came is always 0. So, even if the user sets that to some non-zero value, it will be forced to zero and the values of the remaining in-migration rates will be re-scaled so as to sum to 1.</p>
<p>Given this set up, the expected number of individuals from the outmigrant pool from population <span class="math inline">\(i\)</span> that will arrive in population <span class="math inline">\(j\)</span>, of age <span class="math inline">\(a\)</span> at time <span class="math inline">\(t\)</span> is <span class="math display">\[
E[F^{\mathrm{in},i}_{t,a,j}] = m^{\mathrm{in},i}_{t,a,j} F^{\mathrm{out},i}_{t,a}
\]</span> And, so we can also write that entirely in terms of current population sizes and migration rates: <span class="math display">\[
E[F^{\mathrm{in},i}_{t,a,j}] = m^{\mathrm{in},i}_{t,a,j} m^{\mathrm{out},i}_{t,a}F^i_{t-1,a-1}
\]</span></p>
<p>So, this whole system of specifying migrants is a little more complex than a system whereby the user specifies the fraction of individuals in population <span class="math inline">\(j\)</span> that originated from population <span class="math inline">\(i\)</span>. But, it does provide a lot more control by the user, as well as realism, in that the number of migrants into a population depends on the size of the donor population.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eric C. Anderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
